# New
4 bit counter using ngspice

model M_PMOS pmos level=49 version=3.3.0
.model M_NMOS nmos level=49 version=3.3.0

.SUBCKT INV 1 2 3
1 VDD
2 IN
* 3 OUT
M0 3 2 1 1 M_PMOS L=1.0u W=4u
M1 3 2 0 0 M_NMOS L=1.0u W=10u
.ENDS

.SUBCKT NAND2 1 2 3 4
1 VDD
2 IN 1
3 IN 2
4 OUT
M0 4 2 1 1 M_PMOS L=1.0u W=5u
M1 4 3 1 1 M_PMOS L=1.0u W=5u
M2 4 2 5 5 M_NMOS l=1.0U w=15.0U
M3 5 3 0 0 M_NMOS L=1.0u W=20.0u
.ENDS

.SUBCKT NAND3 1 2 3 4 5
1 VDD
2 IN 1
3 IN 2
4 IN 3
5 OUT
M0 5 2 1 1 M_PMOS L=1.0u W=5u
M1 5 3 1 1 M_PMOS L=1.0u W=5u
M2 5 4 1 1 M_PMOS L=1.0u W=5u
M4 5 2 6 6 M_NMOS L=1.0u W=15.0u
M5 6 3 7 7 M_NMOS L=1.0u W=20.0u
M6 7 4 0 0 M_NMOS L=1.0u W=30.0u
R0 8 0 1.0M
.ENDS

.SUBCKT AND2 1 2 3 4
1 VDD
2 IN 1
3 IN 2
4 OUT
XNAD0 1 2 3 5 NAND2
XINO 1 5 4 INV
.ENDS

.SUBCKT JKFF 1 2 3 4 5 6
1 VDD
2 J
3 K
4 CLK
5 Q
6 QB
XND0 1 6 4 2 7 NAND3
XND1 1 5 4 3 8 NAND3
XND2 1 7 6 5 NAND2
XND3 1 8 5 6 NAND2
.ENDS

VDD 1 0 DC 5.0
VIN2B 2 0 DC 0 PULSE(0 3 0 5NS 5NS 90NS 200NS)

XINV0 1 2 3 INV
XBUF 1 4 5 6 7 8 9 10 11 BUFFER
XJK0 1 1 1 2 Q0 Q0B JKFF
XJK1 1 1 1 Q0 Q1 Q1B JKFF
XAN0 1 Q0 Q1 J2 AND2
XJK2 1 1 1 Q1 Q2 Q2B JKFF
*XAN1 1 Q1 Q2 J3 AND2
XJK3 1 1 1 Q2 Q3 Q3B JKFF

.TRAN 500p 6400NS
*.PRINT TRAN V(14) V(17)
.control
run

plot v(2)
plot v(Q0) V(Q0B)
plot v(Q1) V(Q1B)
plot v(Q2) V(Q2B)
plot v(Q3) V(Q3B)
plot v(1)

.ENDC
.END
